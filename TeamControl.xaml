<UserControl x:Class="Einsatzueberwachung.TeamControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:fa="http://schemas.fontawesome.io/icons/"
             x:Name="TeamControlRoot">

    <UserControl.Resources>
        <!-- Professional Team Card Style using global design system -->
        <Style x:Key="TeamCard" TargetType="Border" BasedOn="{StaticResource CardElevated}">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="MinHeight" Value="360"/>
        </Style>
        
        <!-- Enhanced Timer Button -->
        <Style x:Key="TimerButton" TargetType="Button" BasedOn="{StaticResource FilledButton}">
            <Setter Property="Width" Value="70"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Margin" Value="3"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>

        <!-- Icon Button for Delete -->
        <Style x:Key="DeleteButton" TargetType="Button" BasedOn="{StaticResource FAB}">
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Background" Value="{DynamicResource Error}"/>
        </Style>

        <!-- Team Type Badge -->
        <Style x:Key="TeamTypeBadge" TargetType="Button" BasedOn="{StaticResource TextButton}">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <!-- Enhanced Input Field -->
        <Style x:Key="TeamTextField" TargetType="TextBox" BasedOn="{StaticResource TextField}">
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Professional Label -->
        <Style x:Key="TeamLabel" TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource OnSurfaceVariant}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Margin" Value="0,4,0,2"/>
        </Style>

        <!-- Enhanced Animations -->
        <Storyboard x:Key="WarningPulse" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="1.0" To="0.5" Duration="0:0:0.8" AutoReverse="True"/>
        </Storyboard>

        <Storyboard x:Key="CardEntrance">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.6"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                           From="0.9" To="1" Duration="0:0:0.6"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                           From="0.9" To="1" Duration="0:0:0.6"/>
        </Storyboard>
    </UserControl.Resources>

    <Border x:Name="TeamBorder" Style="{StaticResource TeamCard}"
            RenderTransformOrigin="0.5,0.5">
        
        <Border.RenderTransform>
            <ScaleTransform ScaleX="1" ScaleY="1"/>
        </Border.RenderTransform>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 🏷️ Team Header with Professional Layout -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Team Info & Status -->
                <StackPanel Grid.Column="0">
                    <!-- Warning Indicator & Team Name -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Border x:Name="WarningIndicator" 
                               Width="12" Height="12" CornerRadius="6" 
                               Background="Transparent" 
                               VerticalAlignment="Center" 
                               Margin="0,0,8,0"/>

                        <TextBlock x:Name="TeamNameText"
                                  Text="{Binding TeamName, ElementName=TeamControlRoot}" 
                                  Style="{StaticResource TitleMedium}"
                                  Foreground="{DynamicResource OnSurface}"
                                  VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Team Type Badge with Professional Styling -->
                    <Button x:Name="TeamTypeBadgeButton" 
                           Style="{StaticResource TeamTypeBadge}"
                           Click="TeamTypeBadgeButton_Click"
                           HorizontalAlignment="Left"
                           ToolTip="Spezialisierung bearbeiten">
                        <Border x:Name="TeamTypeBadge" 
                               Background="{DynamicResource Primary}"
                               CornerRadius="16" Padding="12,6">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="TeamTypeText"
                                          Foreground="White" 
                                          Style="{StaticResource LabelSmall}"/>
                                <fa:ImageAwesome Icon="Edit" Width="10" Height="10" 
                                               Foreground="White" Margin="8,0,0,0" Opacity="0.8"/>
                            </StackPanel>
                        </Border>
                    </Button>

                    <!-- Warning Status -->
                    <TextBlock x:Name="WarningStatusText"
                              Style="{StaticResource LabelMedium}"
                              Margin="0,4,0,0"/>
                </StackPanel>

                <!-- Delete Button -->
                <Button x:Name="BtnDeleteTeam" Grid.Column="1" 
                       Click="BtnDeleteTeam_Click"
                       Style="{StaticResource DeleteButton}"
                       ToolTip="Team löschen" 
                       VerticalAlignment="Top">
                    <fa:ImageAwesome Icon="Trash" Width="14" Height="14" Foreground="White"/>
                </Button>
            </Grid>

            <!-- ⏱️ Timer Section with Modern Design -->
            <Border Grid.Row="1" Style="{StaticResource Card}"
                   Background="{DynamicResource SurfaceVariant}"
                   Margin="0,0,0,16" Padding="16">
                <StackPanel>
                    <!-- Timer Display -->
                    <TextBlock x:Name="TimerDisplay" 
                              Text="{Binding ElapsedTimeString, ElementName=TeamControlRoot}" 
                              Style="{StaticResource DisplaySmall}"
                              Foreground="{DynamicResource Primary}"
                              HorizontalAlignment="Center" 
                              FontFamily="Consolas"
                              Margin="0,0,0,12"/>
                    
                    <!-- Timer Controls -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button x:Name="BtnStart" Click="BtnStart_Click"
                               Style="{StaticResource TimerButton}" 
                               Background="{DynamicResource Success}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Play" Width="10" Height="10" 
                                               Margin="0,0,4,0" Foreground="White"/>
                                <TextBlock Text="Start" Foreground="White" Style="{StaticResource LabelSmall}"/>
                            </StackPanel>
                        </Button>
                        
                        <Button x:Name="BtnStop" Click="BtnStop_Click"
                               Style="{StaticResource TimerButton}" 
                               Background="{DynamicResource Warning}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Stop" Width="10" Height="10" 
                                               Margin="0,0,4,0" Foreground="White"/>
                                <TextBlock Text="Stop" Foreground="White" Style="{StaticResource LabelSmall}"/>
                            </StackPanel>
                        </Button>
                        
                        <Button x:Name="BtnReset" Click="BtnReset_Click"
                               Style="{StaticResource TimerButton}" 
                               Background="{DynamicResource Error}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Refresh" Width="10" Height="10" 
                                               Margin="0,0,4,0" Foreground="White"/>
                                <TextBlock Text="Reset" Foreground="White" Style="{StaticResource LabelSmall}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- 👥 Team Information -->
            <Grid Grid.Row="2" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Dog Information -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,0">
                    <Label Style="{StaticResource TeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="Paw" Width="12" Height="12" 
                                           Foreground="{DynamicResource OnSurfaceVariant}" Margin="0,0,4,0"/>
                            <TextBlock Text="Hund" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox x:Name="TxtHund" 
                            Text="{Binding HundName, ElementName=TeamControlRoot, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource TeamTextField}"/>
                </StackPanel>

                <!-- Handler Information -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,0">
                    <Label Style="{StaticResource TeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="User" Width="12" Height="12" 
                                           Foreground="{DynamicResource OnSurfaceVariant}" Margin="0,0,4,0"/>
                            <TextBlock Text="Hundeführer" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox x:Name="TxtHundefuehrer" 
                            Text="{Binding Hundefuehrer, ElementName=TeamControlRoot, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource TeamTextField}"/>
                </StackPanel>

                <!-- Helpers Information -->
                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                    <Label Style="{StaticResource TeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="Users" Width="12" Height="12" 
                                           Foreground="{DynamicResource OnSurfaceVariant}" Margin="0,0,4,0"/>
                            <TextBlock Text="Helfer" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox x:Name="TxtHelfer" 
                            Text="{Binding Helfer, ElementName=TeamControlRoot, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource TeamTextField}"/>
                </StackPanel>
            </Grid>

            <!-- 📝 Enhanced Notes Section -->
            <Grid Grid.Row="3">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Notes Header -->
                <Label Grid.Row="0" Style="{StaticResource TeamLabel}">
                    <StackPanel Orientation="Horizontal">
                        <fa:ImageAwesome Icon="CommentOutline" Width="12" Height="12" 
                                       Foreground="{DynamicResource OnSurfaceVariant}" Margin="0,0,4,0"/>
                        <TextBlock Text="Funksprüche / Notizen" VerticalAlignment="Center"/>
                    </StackPanel>
                </Label>
                
                <!-- Quick Note Input -->
                <Grid Grid.Row="1" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox x:Name="TxtQuickNote" Grid.Column="0" 
                            Style="{StaticResource TeamTextField}" 
                            Margin="0,0,8,0"
                            KeyDown="TxtQuickNote_KeyDown"
                            Text="{Binding QuickNoteText, ElementName=TeamControlRoot, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Enter-Taste oder '+' zum Hinzufügen"/>
                    
                    <Button x:Name="BtnAddNote" Grid.Column="1" Click="BtnAddNote_Click"
                           Style="{StaticResource FAB}"
                           Width="32" Height="32"
                           Background="{DynamicResource Success}"
                           ToolTip="Notiz mit Zeitstempel hinzufügen">
                        <fa:ImageAwesome Icon="Plus" Width="12" Height="12" Foreground="White"/>
                    </Button>
                </Grid>

                <!-- Notes Display -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" MaxHeight="100"
                             Margin="0,0,0,8">
                    <ItemsControl x:Name="NotesItemsControl" 
                                 ItemsSource="{Binding Team.NotesEntries, ElementName=TeamControlRoot}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SurfaceVariant}" 
                                       BorderBrush="{DynamicResource OutlineVariant}" 
                                       BorderThickness="1" CornerRadius="8" 
                                       Margin="0,2" Padding="8,4">
                                    <TextBlock Text="{Binding FormattedEntry}" 
                                              Style="{StaticResource BodySmall}"
                                              Foreground="{DynamicResource OnSurface}"
                                              TextWrapping="Wrap"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Legacy Notes Field -->
                <TextBox Grid.Row="3" x:Name="TxtNotizen" 
                        Text="{Binding Notizen, ElementName=TeamControlRoot, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource TeamTextField}" 
                        AcceptsReturn="True" 
                        VerticalScrollBarVisibility="Auto" 
                        Height="60" 
                        TextWrapping="Wrap"/>
            </Grid>
        </Grid>
    </Border>
</UserControl>
