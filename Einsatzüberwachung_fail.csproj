<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <UseWPF>true</UseWPF>
    
    <!-- Fix namespace issue -->
    <RootNamespace>Einsatzueberwachung</RootNamespace>
    <AssemblyName>Einsatzueberwachung</AssemblyName>
    
    <!-- Application Metadata -->
    <AssemblyTitle>Einsatz√ºberwachung Professional v1.7</AssemblyTitle>
    <AssemblyDescription>Professionelle Einsatz√ºberwachung f√ºr Rettungshunde-Teams mit automatischer Mobile-Konfiguration und GitHub Auto-Updates</AssemblyDescription>
    <AssemblyCompany>RescueDog_SW</AssemblyCompany>
    <AssemblyProduct>Einsatz√ºberwachung Professional v1.7</AssemblyProduct>
    <AssemblyCopyright>Copyright ¬© 2024 RescueDog_SW</AssemblyCopyright>
    <AssemblyVersion>1.7.0.0</AssemblyVersion>
    <FileVersion>1.7.0.0</FileVersion>
    <Version>1.7.0</Version>
    
    <!-- Release Configuration -->
    <PublishSingleFile>true</PublishSingleFile>
    <SelfContained>false</SelfContained>
    <PublishReadyToRun>true</PublishReadyToRun>
    <IncludeNativeLibrariesForSelfExtract>true</IncludeNativeLibrariesForSelfExtract>
    
    <!-- Application Icon -->
    <ApplicationIcon>Resources\app.ico</ApplicationIcon>
    
    <!-- Code Analysis -->
    <EnableNETAnalyzers>true</EnableNETAnalyzers>
    <AnalysisLevel>latest</AnalysisLevel>
    <WarningsAsErrors />
    <WarningsNotAsErrors />
    <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
    
    <!-- Suppress specific warnings globally -->
    <NoWarn>$(NoWarn);CA1303;CA1305;CA1304;CA1822;CA2007;CA1062;CA1031;CA1416;CA2254;CA1848;CA1851;CA1001;CA2000;CA1308;CA1309;IL2026;IL3050;IDE0028;IDE0290;IDE0300</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="FontAwesome.WPF" Version="4.7.0.9" />
    <PackageReference Include="QRCoder" Version="1.6.0" />
    <PackageReference Include="QuestPDF" Version="2024.12.3" />
  </ItemGroup>

  <!-- Include Resources -->
  <ItemGroup>
    <Resource Include="Resources\**\*" />
  </ItemGroup>

  <!-- Copy Mobile HTML Template to output directory -->
  <ItemGroup>
    <None Include="Einsatz√ºberwachung_Clean.csproj" />
=======
>>>>>>> 3e04e591bbe091410a21d73e1a200906d6219c54
    <None Include="Services\MobileHTMLTemplate.txt">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <!-- Clean up problematic files -->
  <ItemGroup>
    <None Remove="HelpWindowSimple.xaml" />
    <None Remove="app.manifest" />
  </ItemGroup>

  <ItemGroup>
    <Compile Remove="HelpWindowSimple.xaml.cs" />
    <Compile Remove="MainWindowComplete.xaml.cs" />
  </ItemGroup>

  <ItemGroup>
    <Page Remove="HelpWindowSimple.xaml" />
    <Page Remove="Resources\DesignSystem.xaml" />
  </ItemGroup>

  <ItemGroup>
    <None Include=".github\workflows\release.yml" />
  </ItemGroup>

  <ItemGroup>
    <Resource Update="Resources\DesignSystem.xaml">
      <Generator>MSBuild:Compile</Generator>
    </Resource>
  </ItemGroup>

  <!-- Setup-Files f√ºr Deployment -->
  <ItemGroup>
    <SetupFiles Include="Fix-MobileServer.ps1" />
    <SetupFiles Include="Setup-MobileNetwork.ps1" />
    <SetupFiles Include="SERVER_START_LOESUNGSANLEITUNG_FINAL.md" />
    <SetupFiles Include="SETUP_INSTALLATION_GUIDE.md" />
    <SetupFiles Include="HTTP_400_TROUBLESHOOTING.md" />
    <SetupFiles Include="MOBILE_SETUP_GUIDE.md" />
    <SetupFiles Include="AUTOMATIC_NETWORK_SETUP.md" />
  </ItemGroup>

  <!-- Custom MSBuild Target f√ºr Setup-Erstellung -->
  <Target Name="CreateSetup" AfterTargets="Publish" Condition="'$(GenerateSetup)' == 'true'">
    <Message Text="üöÄ Bereite Setup-Erstellung vor..." Importance="high" />
    
    <!-- Erstelle Setup-Verzeichnisse -->
    <MakeDir Directories="$(SetupOutputDir)" />
    <MakeDir Directories="Setup\Resources" />
    
    <!-- Kopiere Setup-Dateien -->
    <Copy SourceFiles="@(SetupFiles)" DestinationFolder="Setup\Documentation" />
    
    <!-- Erstelle License.txt und ReadMe.txt falls nicht vorhanden -->
    <WriteLinesToFile File="License.txt" Lines="MIT License%0D%0A%0D%0ACopyright (c) 2024 RescueDog_SW%0D%0A%0D%0APermission is hereby granted, free of charge, to any person obtaining a copy of this software..." Condition="!Exists('License.txt')" />
    
    <Message Text="‚úÖ Setup-Dateien vorbereitet" Importance="high" />
    
    <!-- Pr√ºfe ob Inno Setup verf√ºgbar ist -->
    <PropertyGroup>
      <InnoSetupPath Condition="Exists('$(ProgramFiles)\Inno Setup 6\ISCC.exe')">$(ProgramFiles)\Inno Setup 6\ISCC.exe</InnoSetupPath>
      <InnoSetupPath Condition="'$(InnoSetupPath)' == '' AND Exists('$(MSBuildProgramFiles32)\Inno Setup 6\ISCC.exe')">$(MSBuildProgramFiles32)\Inno Setup 6\ISCC.exe</InnoSetupPath>
    </PropertyGroup>
    
    <!-- F√ºhre Inno Setup aus falls verf√ºgbar -->
    <Exec Command="&quot;$(InnoSetupPath)&quot; &quot;$(SetupScriptPath)&quot;" Condition="'$(InnoSetupPath)' != '' AND Exists('$(SetupScriptPath)')" ContinueOnError="false" />
    
    <Message Text="üéâ Setup.exe erfolgreich erstellt: $(SetupOutputDir)\Einsatzueberwachung_Professional_v1.6_Setup.exe" Importance="high" Condition="'$(InnoSetupPath)' != ''" />
    
    <Warning Text="Inno Setup nicht gefunden. Laden Sie es von https://jrsoftware.org/isinfo.php herunter und f√ºhren Sie Setup\Einsatzueberwachung_Setup.iss manuell aus." Condition="'$(InnoSetupPath)' == ''" />
  </Target>

  <!-- Target f√ºr PowerShell Build-Script -->
  <Target Name="RunBuildScript">
    <Message Text="üöÄ F√ºhre Build-Script aus..." Importance="high" />
    <Exec Command="powershell.exe -ExecutionPolicy Bypass -File Build-Setup.ps1" />
  </Target>

  <!-- Target f√ºr Silent Setup Creation -->
  <Target Name="CreateSilentSetup" AfterTargets="Publish">
    <Message Text="üì¶ Erstelle Setup ohne Benutzerinteraktion..." Importance="high" />
    <Exec Command="powershell.exe -ExecutionPolicy Bypass -File Build-Setup.ps1 -CleanBuild -SkipTests" />
  </Target>

</Project>
