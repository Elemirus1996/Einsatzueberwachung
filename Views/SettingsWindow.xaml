<Window x:Class="Einsatzueberwachung.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Einsatzueberwachung.ViewModels"
        Title="⚙️ Einstellungen - Einsatzüberwachung Professional"
        Width="800" Height="600"
        MinWidth="700" MinHeight="500"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource Surface}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Window.DataContext>
        <vm:SettingsViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Navigation -->
        <Border Grid.Column="0" Background="{DynamicResource SurfaceVariant}">
            <StackPanel Margin="16">
                <TextBlock Text="⚙️ Einstellungen" FontSize="18" FontWeight="Bold" 
                          Foreground="{DynamicResource Primary}" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                
                <Button Content="🎨 Darstellung" Style="{StaticResource OutlinedButton}" 
                       Margin="0,4" Click="ShowAppearanceSettings"/>
                <Button Content="⚠️ Warnungen" Style="{StaticResource OutlinedButton}" 
                       Margin="0,4" Click="ShowWarningSettings"/>
                <Button Content="📱 Mobile" Style="{StaticResource OutlinedButton}" 
                       Margin="0,4" Click="ShowMobileSettings"/>
                <Button Content="🔄 Updates" Style="{StaticResource OutlinedButton}" 
                       Margin="0,4" Click="ShowUpdateSettings"/>
                <Button Content="🗄️ Stammdaten" Style="{StaticResource OutlinedButton}" 
                       Margin="0,4" Click="ShowMasterDataSettings"/>
                <Button Content="ℹ️ Info" Style="{StaticResource OutlinedButton}" 
                       Margin="0,4" Click="ShowInfoSettings"/>
            </StackPanel>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Appearance Settings -->
                <StackPanel x:Name="AppearancePanel" Visibility="Visible">
                    <TextBlock Text="🎨 Theme und Darstellung" FontSize="20" FontWeight="Bold" 
                              Foreground="{DynamicResource Primary}" Margin="0,0,0,20"/>
                    
                    <Border Style="{StaticResource Card}" Padding="20" Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Theme-Modus" FontWeight="Bold" Margin="0,0,0,8"
                                      Foreground="{DynamicResource OnSurface}"/>
                            
                            <RadioButton Content="Automatisch (Tag/Nacht)" 
                                        IsChecked="{Binding IsAutoMode}" 
                                        Margin="0,4"
                                        Foreground="{DynamicResource OnSurface}"/>
                            <RadioButton Content="Manuell" 
                                        IsChecked="{Binding IsManualMode, Mode=OneWay}" 
                                        Checked="ManualModeRadioButton_Checked"
                                        Margin="0,4"
                                        Foreground="{DynamicResource OnSurface}"/>
                            
                            <!-- Automatik-Zeitkonfiguration -->
                            <Border Background="{DynamicResource SurfaceVariant}" 
                                   CornerRadius="8" Padding="16" Margin="0,12,0,0"
                                   Visibility="{Binding IsAutoMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="⏰ Automatische Umschaltzeiten" FontWeight="Medium" 
                                              Foreground="{DynamicResource Primary}" Margin="0,0,0,12"/>
                                    
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Dark Mode Start -->
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="🌙 Dunkel-Modus ab:" FontWeight="Medium" 
                                                      Foreground="{DynamicResource OnSurface}" Margin="0,0,0,8"/>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <!-- Stunden ComboBox 0-23 -->
                                                <ComboBox x:Name="DarkModeHourComboBox" 
                                                         SelectedValue="{Binding DarkModeHours, Mode=TwoWay}"
                                                         SelectedValuePath="Content"
                                                         Style="{StaticResource ComboBoxStyle}"
                                                         Width="80" Height="40" Margin="0,0,8,0">
                                                    <ComboBoxItem Content="00"/>
                                                    <ComboBoxItem Content="01"/>
                                                    <ComboBoxItem Content="02"/>
                                                    <ComboBoxItem Content="03"/>
                                                    <ComboBoxItem Content="04"/>
                                                    <ComboBoxItem Content="05"/>
                                                    <ComboBoxItem Content="06"/>
                                                    <ComboBoxItem Content="07"/>
                                                    <ComboBoxItem Content="08"/>
                                                    <ComboBoxItem Content="09"/>
                                                    <ComboBoxItem Content="10"/>
                                                    <ComboBoxItem Content="11"/>
                                                    <ComboBoxItem Content="12"/>
                                                    <ComboBoxItem Content="13"/>
                                                    <ComboBoxItem Content="14"/>
                                                    <ComboBoxItem Content="15"/>
                                                    <ComboBoxItem Content="16"/>
                                                    <ComboBoxItem Content="17"/>
                                                    <ComboBoxItem Content="18"/>
                                                    <ComboBoxItem Content="19"/>
                                                    <ComboBoxItem Content="20"/>
                                                    <ComboBoxItem Content="21"/>
                                                    <ComboBoxItem Content="22"/>
                                                    <ComboBoxItem Content="23"/>
                                                </ComboBox>
                                                <TextBlock Text=":" VerticalAlignment="Center" 
                                                          FontSize="24" FontWeight="Bold" Margin="0,0,8,0"
                                                          Foreground="{DynamicResource Primary}"/>
                                                <!-- Minuten ComboBox 0-59 in 5er Schritten -->
                                                <ComboBox x:Name="DarkModeMinuteComboBox"
                                                         SelectedValue="{Binding DarkModeMinutes, Mode=TwoWay}"
                                                         SelectedValuePath="Content"
                                                         Style="{StaticResource ComboBoxStyle}"
                                                         Width="80" Height="40">
                                                    <ComboBoxItem Content="00"/>
                                                    <ComboBoxItem Content="05"/>
                                                    <ComboBoxItem Content="10"/>
                                                    <ComboBoxItem Content="15"/>
                                                    <ComboBoxItem Content="20"/>
                                                    <ComboBoxItem Content="25"/>
                                                    <ComboBoxItem Content="30"/>
                                                    <ComboBoxItem Content="35"/>
                                                    <ComboBoxItem Content="40"/>
                                                    <ComboBoxItem Content="45"/>
                                                    <ComboBoxItem Content="50"/>
                                                    <ComboBoxItem Content="55"/>
                                                </ComboBox>
                                            </StackPanel>
                                            <TextBlock Text="Standard: 18:00 Uhr" FontSize="11" 
                                                      Foreground="{DynamicResource OnSurfaceVariant}" 
                                                      HorizontalAlignment="Center" Margin="0,8,0,0"/>
                                        </StackPanel>
                                        
                                        <!-- Separator -->
                                        <Rectangle Grid.Column="1" Width="2" Fill="{DynamicResource Primary}" 
                                                  HorizontalAlignment="Center" Margin="16,0"/>
                                        
                                        <!-- Light Mode Start -->
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="🌞 Hell-Modus ab:" FontWeight="Medium" 
                                                      Foreground="{DynamicResource OnSurface}" Margin="0,0,0,8"/>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <!-- Stunden ComboBox 0-23 -->
                                                <ComboBox x:Name="LightModeHourComboBox"
                                                         SelectedValue="{Binding LightModeHours, Mode=TwoWay}"
                                                         SelectedValuePath="Content"
                                                         Style="{StaticResource ComboBoxStyle}"
                                                         Width="80" Height="40" Margin="0,0,8,0">
                                                    <ComboBoxItem Content="00"/>
                                                    <ComboBoxItem Content="01"/>
                                                    <ComboBoxItem Content="02"/>
                                                    <ComboBoxItem Content="03"/>
                                                    <ComboBoxItem Content="04"/>
                                                    <ComboBoxItem Content="05"/>
                                                    <ComboBoxItem Content="06"/>
                                                    <ComboBoxItem Content="07"/>
                                                    <ComboBoxItem Content="08"/>
                                                    <ComboBoxItem Content="09"/>
                                                    <ComboBoxItem Content="10"/>
                                                    <ComboBoxItem Content="11"/>
                                                    <ComboBoxItem Content="12"/>
                                                    <ComboBoxItem Content="13"/>
                                                    <ComboBoxItem Content="14"/>
                                                    <ComboBoxItem Content="15"/>
                                                    <ComboBoxItem Content="16"/>
                                                    <ComboBoxItem Content="17"/>
                                                    <ComboBoxItem Content="18"/>
                                                    <ComboBoxItem Content="19"/>
                                                    <ComboBoxItem Content="20"/>
                                                    <ComboBoxItem Content="21"/>
                                                    <ComboBoxItem Content="22"/>
                                                    <ComboBoxItem Content="23"/>
                                                </ComboBox>
                                                <TextBlock Text=":" VerticalAlignment="Center" 
                                                          FontSize="24" FontWeight="Bold" Margin="0,0,8,0"
                                                          Foreground="{DynamicResource Primary}"/>
                                                <!-- Minuten ComboBox 0-59 in 5er Schritten -->
                                                <ComboBox x:Name="LightModeMinuteComboBox"
                                                         SelectedValue="{Binding LightModeMinutes, Mode=TwoWay}"
                                                         SelectedValuePath="Content"
                                                         Style="{StaticResource ComboBoxStyle}"
                                                         Width="80" Height="40">
                                                    <ComboBoxItem Content="00"/>
                                                    <ComboBoxItem Content="05"/>
                                                    <ComboBoxItem Content="10"/>
                                                    <ComboBoxItem Content="15"/>
                                                    <ComboBoxItem Content="20"/>
                                                    <ComboBoxItem Content="25"/>
                                                    <ComboBoxItem Content="30"/>
                                                    <ComboBoxItem Content="35"/>
                                                    <ComboBoxItem Content="40"/>
                                                    <ComboBoxItem Content="45"/>
                                                    <ComboBoxItem Content="50"/>
                                                    <ComboBoxItem Content="55"/>
                                                </ComboBox>
                                            </StackPanel>
                                            <TextBlock Text="Standard: 08:00 Uhr" FontSize="11" 
                                                      Foreground="{DynamicResource OnSurfaceVariant}" 
                                                      HorizontalAlignment="Center" Margin="0,8,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <!-- Schnell-Buttons für häufige Zeiten -->
                                    <TextBlock Text="⚡ Schnellauswahl:" FontWeight="Medium" 
                                              Foreground="{DynamicResource OnSurface}" Margin="0,16,0,8"/>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="🌅 06:00 - 20:00" Click="SetTimePreset_EarlySummer"
                                               Style="{StaticResource TextButton}" FontSize="11" 
                                               Padding="8,4" Margin="0,0,8,0"
                                               ToolTip="Früher Sommer: Hell 06:00, Dunkel 20:00"/>
                                        <Button Content="🌇 08:00 - 18:00" Click="SetTimePreset_Standard"
                                               Style="{StaticResource TextButton}" FontSize="11" 
                                               Padding="8,4" Margin="0,0,8,0"
                                               ToolTip="Standard: Hell 08:00, Dunkel 18:00"/>
                                        <Button Content="🌃 09:00 - 17:00" Click="SetTimePreset_Winter"
                                               Style="{StaticResource TextButton}" FontSize="11" 
                                               Padding="8,4"
                                               ToolTip="Winter: Hell 09:00, Dunkel 17:00"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- Manueller Modus -->
                            <StackPanel Margin="0,12,0,0" x:Name="ManualModePanel"
                                       Visibility="{Binding IsManualMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <RadioButton Content="🌞 Hell" 
                                            x:Name="LightModeRadio"
                                            Checked="LightModeRadioButton_Checked"
                                            IsEnabled="{Binding IsManualMode}"
                                            Margin="20,4"
                                            Foreground="{DynamicResource OnSurface}"/>
                                <RadioButton Content="🌙 Dunkel" 
                                            Checked="DarkModeRadioButton_Checked"
                                            IsEnabled="{Binding IsManualMode}"
                                            Margin="20,4"
                                            Foreground="{DynamicResource OnSurface}"/>
                            </StackPanel>
                            
                            <Button Content="Theme anwenden" 
                                   Command="{Binding ApplyThemeCommand}"
                                   Style="{StaticResource FilledButton}" 
                                   HorizontalAlignment="Left" Margin="0,16,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Warning Settings -->
                <StackPanel x:Name="WarningPanel" Visibility="Collapsed">
                    <TextBlock Text="⚠️ Timer-Warnungen" FontSize="20" FontWeight="Bold" 
                              Foreground="{DynamicResource Primary}" Margin="0,0,0,20"/>
                    
                    <Border Style="{StaticResource Card}" Padding="20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Erste Warnung -->
                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                <TextBlock Text="Erste Warnung" FontWeight="Bold"
                                          Foreground="{DynamicResource OnSurface}"/>
                                <Slider Value="{Binding FirstWarningMinutes}" 
                                       Minimum="1" Maximum="60" 
                                       Margin="0,8"/>
                                <TextBlock Text="{Binding FirstWarningMinutes}" 
                                          HorizontalAlignment="Center"
                                          Foreground="{DynamicResource OnSurfaceVariant}"/>
                            </StackPanel>

                            <!-- Zweite Warnung -->
                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                <TextBlock Text="Zweite Warnung" FontWeight="Bold"
                                          Foreground="{DynamicResource OnSurface}"/>
                                <Slider Value="{Binding SecondWarningMinutes}" 
                                       Minimum="15" Maximum="120" 
                                       Margin="0,8"/>
                                <TextBlock Text="{Binding SecondWarningMinutes}" 
                                          HorizontalAlignment="Center"
                                          Foreground="{DynamicResource OnSurfaceVariant}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Mobile Settings -->
                <StackPanel x:Name="MobilePanel" Visibility="Collapsed">
                    <TextBlock Text="📱 Mobile Integration" FontSize="20" FontWeight="Bold" 
                              Foreground="{DynamicResource Primary}" Margin="0,0,0,20"/>
                    
                    <Border Style="{StaticResource Card}" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Server Port" FontWeight="Bold" Margin="0,0,0,8"
                                      Foreground="{DynamicResource OnSurface}"/>
                            <TextBox Text="{Binding MobileServerPort}" 
                                    Style="{StaticResource TextField}" Width="100" HorizontalAlignment="Left"/>
                            
                            <CheckBox Content="Mobile Server automatisch starten" 
                                     IsChecked="{Binding AutoStartMobileServer}" 
                                     Margin="0,16,0,0"
                                     Foreground="{DynamicResource OnSurface}"/>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                                <Button Content="📱 Mobile öffnen" 
                                       Command="{Binding OpenMobileConnectionCommand}"
                                       Style="{StaticResource FilledButton}" Margin="0,0,10,0"/>
                                <Button Content="🧪 Test" 
                                       Command="{Binding TestMobileServerCommand}"
                                       Style="{StaticResource OutlinedButton}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Update Settings -->
                <StackPanel x:Name="UpdatePanel" Visibility="Collapsed">
                    <TextBlock Text="🔄 Automatische Updates" FontSize="20" FontWeight="Bold" 
                              Foreground="{DynamicResource Primary}" Margin="0,0,0,20"/>
                    
                    <Border Style="{StaticResource Card}" Padding="20">
                        <StackPanel>
                            <CheckBox Content="Update-Benachrichtigungen aktivieren" 
                                     IsChecked="{Binding EnableUpdateNotifications}" 
                                     Margin="0,0,0,12"
                                     Foreground="{DynamicResource OnSurface}"/>

                            <CheckBox Content="Beta-Updates einschließen" 
                                     IsChecked="{Binding CheckForBetaUpdates}" 
                                     IsEnabled="{Binding EnableUpdateNotifications}"
                                     Foreground="{DynamicResource OnSurface}"/>
                            
                            <Button Content="🔍 Nach Updates suchen" 
                                   Command="{Binding CheckForUpdatesCommand}"
                                   Style="{StaticResource FilledButton}" 
                                   HorizontalAlignment="Left" Margin="0,16,0,0"
                                   ToolTip="Update-Prüfung starten"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Info Settings -->
                <StackPanel x:Name="InfoPanel" Visibility="Collapsed">
                    <TextBlock Text="ℹ️ Hilfe und Informationen" FontSize="20" FontWeight="Bold" 
                              Foreground="{DynamicResource Primary}" Margin="0,0,0,20"/>
                    
                    <Border Style="{StaticResource Card}" Padding="20">
                        <StackPanel>
                            <TextBlock Text="🐕‍🦺 Einsatzüberwachung Professional" 
                                      FontSize="16" FontWeight="SemiBold" Margin="0,0,0,16"
                                      Foreground="{DynamicResource OnSurface}"/>
                            
                            <TextBlock Text="{Binding AppVersion}" Margin="0,0,0,8"
                                      Foreground="{DynamicResource OnSurfaceVariant}"/>
                            <TextBlock Text="{Binding CurrentThemeStatus}" Margin="0,0,0,16"
                                      Foreground="{DynamicResource OnSurfaceVariant}"/>
                            
                            <StackPanel Orientation="Horizontal">
                                <Button Content="📖 Hilfe" 
                                       Command="{Binding OpenHelpCommand}"
                                       Style="{StaticResource OutlinedButton}" 
                                       Margin="0,0,10,0"
                                       ToolTip="Hilfe-Fenster öffnen"/>
                                <Button Content="ℹ️ Über" 
                                       Command="{Binding OpenAboutCommand}"
                                       Style="{StaticResource OutlinedButton}"
                                       ToolTip="Info-Fenster öffnen"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Master Data Settings -->
                <StackPanel x:Name="MasterDataPanel" Visibility="Collapsed">
                    <TextBlock Text="🗄️ Stammdaten verwalten" FontSize="20" FontWeight="Bold" 
                              Foreground="{DynamicResource Primary}" Margin="0,0,0,20"/>
                    
                    <Border Style="{StaticResource Card}" Padding="20" Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Personal und Hunde" FontWeight="Bold" Margin="0,0,0,8"
                                      Foreground="{DynamicResource OnSurface}"/>
                            <TextBlock Text="Verwalten Sie Stammdaten für Personal und Hunde zur schnelleren Einsatzerfassung." 
                                      TextWrapping="Wrap" Margin="0,0,0,16"
                                      Foreground="{DynamicResource OnSurfaceVariant}"/>
                            
                            <StackPanel Orientation="Horizontal">
                                <Button Content="👤 Personal verwalten" 
                                       Command="{Binding OpenMasterDataCommand}"
                                       Style="{StaticResource FilledButton}" Margin="0,0,10,0"/>
                                <Button Content="🐕 Hunde verwalten" 
                                       Command="{Binding OpenMasterDataCommand}"
                                       Style="{StaticResource OutlinedButton}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource Card}" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Schnellzugriff" FontWeight="Bold" Margin="0,0,0,8"
                                      Foreground="{DynamicResource OnSurface}"/>
                            <TextBlock Text="Aktivieren Sie diese Option, um beim Erstellen von Teams automatisch auf Stammdaten zuzugreifen." 
                                      TextWrapping="Wrap" Margin="0,0,0,12"
                                      Foreground="{DynamicResource OnSurfaceVariant}"/>
                            
                            <CheckBox Content="Stammdaten bei Teamerstellung automatisch öffnen" 
                                     IsChecked="{Binding AutoOpenMasterDataOnTeamCreation}" 
                                     Margin="0,0,0,12"
                                     Foreground="{DynamicResource OnSurface}"/>
                            
                            <CheckBox Content="Letzte Eingaben als Vorschläge anzeigen" 
                                     IsChecked="{Binding ShowRecentSuggestions}"
                                     Foreground="{DynamicResource OnSurface}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <!-- Action Buttons -->
        <Border Grid.Column="1" VerticalAlignment="Bottom" 
                Background="{DynamicResource Surface}" 
                BorderBrush="{DynamicResource OutlineVariant}" 
                BorderThickness="0,1,0,0" 
                Padding="20,16">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="🔄 Zurücksetzen" 
                       Command="{Binding ResetToDefaultsCommand}"
                       Style="{StaticResource TextButton}" 
                       Margin="0,0,12,0"/>
                <Button Content="💾 Speichern" 
                       Command="{Binding SaveSettingsCommand}"
                       Style="{StaticResource FilledButton}" 
                       Margin="0,0,12,0"/>
                <Button Content="Schließen" 
                       IsCancel="True"
                       Style="{StaticResource OutlinedButton}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
