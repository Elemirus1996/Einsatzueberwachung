<views:BaseThemeWindow x:Class="Einsatzueberwachung.Views.PersonalEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        xmlns:vm="clr-namespace:Einsatzueberwachung.ViewModels"
        xmlns:views="clr-namespace:Einsatzueberwachung.Views"
        Title="{Binding WindowTitle}"
        Height="700" Width="550"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource Surface}"
        ResizeMode="NoResize">

    <!-- DataContext wird über Code-Behind gesetzt -->

    <views:BaseThemeWindow.Resources>
        <!-- Import the converter -->
        <views:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Orange Card Style -->
        <Style x:Key="OrangeEditCard" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource SurfaceContainer}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Primary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect" Value="{StaticResource Elevation2}"/>
        </Style>

        <!-- Orange Input Style - FIXED for proper text display -->
        <Style x:Key="OrangeInputStyle" TargetType="TextBox" BasedOn="{StaticResource EnhancedTextField}">
            <Setter Property="Height" Value="48"/>
            <Setter Property="MinHeight" Value="40"/>
            <Setter Property="Padding" Value="12,12"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="TextWrapping" Value="NoWrap"/>
            <Setter Property="AcceptsReturn" Value="False"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Auto"/>
        </Style>

        <!-- Orange CheckBox Style - Using Global DesignSystem -->
        <Style x:Key="OrangeCheckBoxStyle" TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
            <Setter Property="Margin" Value="0,6"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>

        <!-- Orange Button Styles - Using Global DesignSystem -->
        <Style x:Key="OrangeSaveButton" TargetType="Button" BasedOn="{StaticResource FilledButton}">
            <Setter Property="Padding" Value="20,12"/>
        </Style>

        <Style x:Key="OrangeCancelButton" TargetType="Button" BasedOn="{StaticResource OutlinedButton}">
            <Setter Property="Padding" Value="20,12"/>
        </Style>

        <!-- Section Header Style - Using Global DesignSystem -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock" BasedOn="{StaticResource TitleMedium}">
            <Setter Property="Foreground" Value="{DynamicResource Primary}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>

        <!-- Field Label Style - Using Global DesignSystem -->
        <Style x:Key="FieldLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource LabelMedium}">
            <Setter Property="Foreground" Value="{DynamicResource OnSurfaceVariant}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
    </views:BaseThemeWindow.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Orange Header -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryGradient}" 
                CornerRadius="12" Padding="20" Margin="0,0,0,16"
                Effect="{StaticResource OrangeElevation2}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Orange Icon mit Glow -->
                <Border Grid.Column="0" Width="48" Height="48" CornerRadius="24" 
                       Background="{DynamicResource Surface}" Margin="0,0,16,0"
                       Effect="{StaticResource OrangeGlow}">
                    <fa:ImageAwesome Icon="UserPlus" Width="24" Height="24" 
                                   Foreground="{DynamicResource Primary}"/>
                </Border>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Personal-Daten" 
                              Style="{StaticResource TitleLarge}"
                              Foreground="{DynamicResource OnPrimary}"/>
                    <TextBlock Text="Erfassen Sie die Personalinformationen und Fähigkeiten" 
                              Style="{StaticResource BodyMedium}"
                              Foreground="{DynamicResource OnPrimary}" 
                              Opacity="0.9" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Form Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Basis-Informationen -->
                <Border Style="{StaticResource OrangeEditCard}">
                    <StackPanel>
                        <TextBlock Text="Basis-Informationen" Style="{StaticResource SectionHeaderStyle}"/>

                        <TextBlock Text="Vorname *" Style="{StaticResource FieldLabelStyle}"/>
                        <TextBox Text="{Binding Vorname, UpdateSourceTrigger=PropertyChanged}" 
                                Style="{StaticResource OrangeInputStyle}" Margin="0,0,0,16"/>

                        <TextBlock Text="Nachname *" Style="{StaticResource FieldLabelStyle}"/>
                        <TextBox Text="{Binding Nachname, UpdateSourceTrigger=PropertyChanged}" 
                                Style="{StaticResource OrangeInputStyle}" Margin="0,0,0,16"/>

                        <CheckBox Content="Aktiv" IsChecked="{Binding IsActive}"
                                 Style="{StaticResource OrangeCheckBoxStyle}"/>
                    </StackPanel>
                </Border>

                <!-- Fähigkeiten -->
                <Border Style="{StaticResource OrangeEditCard}">
                    <StackPanel>
                        <TextBlock Text="Fähigkeiten" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBlock Text="Wählen Sie eine oder mehrere Fähigkeiten aus:" 
                                  Style="{StaticResource BodyMedium}"
                                  Foreground="{DynamicResource OnSurfaceVariant}" 
                                  Margin="0,0,0,12" TextWrapping="Wrap"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <CheckBox Content="🐕 Hundeführer" IsChecked="{Binding IsHundefuehrer}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                                <CheckBox Content="🤝 Helfer" IsChecked="{Binding IsHelfer}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                                <CheckBox Content="👨‍💼 Führungsassistent" IsChecked="{Binding IsFuehrungsassistent}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                                <CheckBox Content="👥 Gruppenführer" IsChecked="{Binding IsGruppenfuehrer}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1">
                                <CheckBox Content="🚁 Drohnenpilot" IsChecked="{Binding IsDrohnenpilot}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                                <CheckBox Content="⭐ Zugführer" IsChecked="{Binding IsZugfuehrer}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                                <CheckBox Content="🏆 Verbandsführer" IsChecked="{Binding IsVerbandsfuehrer}"
                                         Style="{StaticResource OrangeCheckBoxStyle}"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Notizen -->
                <Border Style="{StaticResource OrangeEditCard}">
                    <StackPanel>
                        <TextBlock Text="Notizen" Style="{StaticResource SectionHeaderStyle}"/>
                        <TextBox Text="{Binding Notizen, UpdateSourceTrigger=PropertyChanged}" 
                                Style="{StaticResource OrangeInputStyle}" 
                                TextWrapping="Wrap" AcceptsReturn="True" Height="80"
                                VerticalScrollBarVisibility="Auto"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Validation Message -->
        <Border Grid.Row="2" Background="{DynamicResource ErrorContainer}" 
                CornerRadius="8" Padding="12" Margin="8,8,8,0"
                Visibility="{Binding HasValidationError, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <fa:ImageAwesome Icon="ExclamationTriangle" Width="16" Height="16" 
                               Foreground="{DynamicResource OnErrorContainer}" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding ValidationMessage}" 
                          Foreground="{DynamicResource OnErrorContainer}" 
                          Style="{StaticResource BodyMedium}" 
                          TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- Action Buttons -->
        <Border Grid.Row="3" Style="{StaticResource Card}" Margin="8,8,8,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Reset Button -->
                <Button Grid.Column="0" Content="🔄 Zurücksetzen" 
                       Command="{Binding ResetFormCommand}"
                       Style="{StaticResource OrangeCancelButton}" 
                       Width="130" Height="40" Margin="0,0,8,0"/>

                <!-- Spacer -->
                <Rectangle Grid.Column="1"/>

                <!-- Save Button -->
                <Button Grid.Column="2" Content="✓ Speichern" 
                       Command="{Binding SaveCommand}"
                       CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=views:BaseThemeWindow}}"
                       Style="{StaticResource OrangeSaveButton}" 
                       Width="120" Height="40" Margin="0,0,8,0"/>

                <!-- Cancel Button -->
                <Button Grid.Column="3" Content="✗ Abbrechen" 
                       Command="{Binding CancelCommand}"
                       CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=views:BaseThemeWindow}}"
                       Style="{StaticResource OrangeCancelButton}" 
                       Width="120" Height="40"/>
            </Grid>
        </Border>
    </Grid>
</views:BaseThemeWindow>
