<UserControl x:Class="Einsatzueberwachung.Views.TeamControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:fa="http://schemas.fontawesome.io/icons/"
             xmlns:vm="clr-namespace:Einsatzueberwachung.ViewModels"
             x:Name="TeamControlRoot">

    <!-- DataContext wird über Code-Behind gesetzt -->

    <UserControl.Resources>
        <!-- Orange Team Card Style -->
        <Style x:Key="OrangeTeamCard" TargetType="Border" BasedOn="{StaticResource CardElevated}">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="MinHeight" Value="320"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceContainer}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Primary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="{DynamicResource Primary}" 
                                     ShadowDepth="0" BlurRadius="12" Opacity="0.15"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Orange Timer Button -->
        <Style x:Key="OrangeTimerButton" TargetType="Button">
            <Setter Property="Width" Value="90"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="{DynamicResource Primary}" 
                                             ShadowDepth="0" BlurRadius="8" Opacity="0.3"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="{DynamicResource OutlineVariant}"/>
                    <Setter Property="Opacity" Value="0.6"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Orange Delete Button -->
        <Style x:Key="OrangeDeleteButton" TargetType="Button">
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Background" Value="{DynamicResource Error}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="20" 
                                Width="{TemplateBinding Width}" 
                                Height="{TemplateBinding Height}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#D32F2F"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="Red" 
                                             ShadowDepth="0" BlurRadius="8" Opacity="0.4"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Orange Team Type Badge -->
        <Style x:Key="OrangeTeamTypeBadge" TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="12" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="{DynamicResource Primary}" 
                                             ShadowDepth="0" BlurRadius="6" Opacity="0.3"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Orange Input Field -->
        <Style x:Key="OrangeTeamTextField" TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource SurfaceVariant}"/>
            <Setter Property="Foreground" Value="{DynamicResource OnSurface}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Primary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                         VerticalScrollBarVisibility="Hidden" 
                                         HorizontalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{DynamicResource Tertiary}"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="{DynamicResource PrimaryColor}" 
                                                         ShadowDepth="0" BlurRadius="4" Opacity="0.2"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Orange Label Style -->
        <Style x:Key="OrangeTeamLabel" TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource Primary}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Margin" Value="0,4,0,2"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <!-- Enhanced Animations -->
        <Storyboard x:Key="BlinkingAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="1.0" To="0.3" Duration="0:0:0.8" AutoReverse="True"/>
        </Storyboard>

        <Storyboard x:Key="CardEntranceAnimation" RepeatBehavior="1x">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.6"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleX)"
                           From="0.9" To="1" Duration="0:0:0.6"/>
            <DoubleAnimation Storyboard.TargetProperty="(RenderTransform).(ScaleTransform.ScaleY)"
                           From="0.9" To="1" Duration="0:0:0.6"/>
        </Storyboard>
    </UserControl.Resources>

    <Border x:Name="TeamBorder" 
            Style="{StaticResource OrangeTeamCard}"
            Background="{Binding TeamBorderBackground}"
            BorderBrush="{Binding TeamBorderBrush}"
            BorderThickness="{Binding TeamBorderThickness}"
            RenderTransformOrigin="0.5,0.5">
        
        <Border.RenderTransform>
            <ScaleTransform ScaleX="1" ScaleY="1"/>
        </Border.RenderTransform>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Orange Team Header -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Team Info & Status -->
                <StackPanel Grid.Column="0">
                    <!-- Warning Indicator & Team Name -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Border x:Name="WarningIndicator" 
                               Width="14" Height="14" CornerRadius="7" 
                               Background="{Binding WarningIndicatorBackground}" 
                               VerticalAlignment="Center" 
                               Margin="0,0,10,0"/>

                        <TextBlock Text="{Binding TeamName}"
                                  FontSize="20"
                                  FontWeight="Bold"
                                  Foreground="{DynamicResource OnSurface}"
                                  VerticalAlignment="Center"/>
                                  
                        <TextBlock Text="{Binding WarningStatusText}"
                                  FontSize="14"
                                  FontWeight="Bold"
                                  Foreground="{Binding WarningStatusForeground}"
                                  Margin="10,0,0,0"
                                  VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Team Type Badge & Warning Settings -->
                    <StackPanel Orientation="Horizontal">
                        <!-- Team Type Badge -->
                        <Button Command="{Binding EditTeamTypeCommand}" 
                               Style="{StaticResource OrangeTeamTypeBadge}"
                               Background="{Binding TeamTypeBadgeBackground}"
                               ToolTip="{Binding TeamTypeDisplayName}"
                               Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding TeamTypeText}"
                                          Foreground="White" 
                                          FontSize="12" FontWeight="Bold"/>
                                <fa:ImageAwesome Icon="Edit" Width="10" Height="10" 
                                               Foreground="White" Margin="6,0,0,0" Opacity="0.8"/>
                            </StackPanel>
                        </Button>

                        <!-- Warning Settings Button -->
                        <Button Command="{Binding EditWarningSettingsCommand}" 
                               Style="{StaticResource OrangeTeamTypeBadge}"
                               Background="{DynamicResource Warning}"
                               ToolTip="Warnschwellen bearbeiten">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="ClockOutline" Width="10" Height="10" 
                                               Foreground="White" Margin="0,0,6,0"/>
                                <TextBlock Text="{Binding WarningSettingsText}"
                                          Foreground="White" 
                                          FontSize="12" FontWeight="Bold"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>

                <!-- Delete Button -->
                <Button Grid.Column="1" 
                       Command="{Binding DeleteTeamCommand}"
                       Style="{StaticResource OrangeDeleteButton}"
                       ToolTip="Team löschen" 
                       VerticalAlignment="Top">
                    <fa:ImageAwesome Icon="Trash" Width="16" Height="16" Foreground="White"/>
                </Button>
            </Grid>

            <!-- Orange Timer Section -->
            <Border Grid.Row="1" Style="{StaticResource OrangeCard}"
                   Background="{DynamicResource SurfaceVariant}"
                   Margin="0,0,0,16" Padding="16">
                <StackPanel>
                    <!-- Timer Display with Orange Accent -->
                    <Border Background="{DynamicResource Primary}" 
                           CornerRadius="8" Padding="12" Margin="0,0,0,12">
                        <TextBlock Text="{Binding ElapsedTimeString}" 
                                  FontSize="36"
                                  FontWeight="Bold"
                                  Foreground="White"
                                  HorizontalAlignment="Center" 
                                  FontFamily="Consolas"/>
                    </Border>
                    
                    <!-- Timer Controls with Orange Design -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Command="{Binding StartTimerCommand}"
                               Style="{StaticResource OrangeTimerButton}" 
                               Background="{DynamicResource Success}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Play" Width="14" Height="14" 
                                               Margin="0,0,6,0" Foreground="White"/>
                                <TextBlock Text="Start" Foreground="White" FontSize="13" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Command="{Binding StopTimerCommand}"
                               Style="{StaticResource OrangeTimerButton}" 
                               Background="{DynamicResource Warning}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Stop" Width="14" Height="14" 
                                               Margin="0,0,6,0" Foreground="White"/>
                                <TextBlock Text="Stop" Foreground="White" FontSize="13" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Command="{Binding ResetTimerCommand}"
                               Style="{StaticResource OrangeTimerButton}" 
                               Background="{DynamicResource Error}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Refresh" Width="14" Height="14" 
                                               Margin="0,0,6,0" Foreground="White"/>
                                <TextBlock Text="Reset" Foreground="White" FontSize="13" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Orange Team Information - 2 Columns -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Dog Information -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,6,0">
                    <Label Style="{StaticResource OrangeTeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="Paw" Width="12" Height="12" 
                                           Foreground="{DynamicResource Primary}" Margin="0,0,6,0"/>
                            <TextBlock Text="Hund" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox Text="{Binding HundName, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource OrangeTeamTextField}"/>
                </StackPanel>

                <!-- Handler Information -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="6,0,0,0">
                    <Label Style="{StaticResource OrangeTeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="User" Width="12" Height="12" 
                                           Foreground="{DynamicResource Primary}" Margin="0,0,6,0"/>
                            <TextBlock Text="Hundeführer" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox Text="{Binding Hundefuehrer, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource OrangeTeamTextField}"/>
                </StackPanel>

                <!-- Helpers Information -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,6,0">
                    <Label Style="{StaticResource OrangeTeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="Users" Width="12" Height="12" 
                                           Foreground="{DynamicResource Primary}" Margin="0,0,6,0"/>
                            <TextBlock Text="Helfer" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox Text="{Binding Helfer, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource OrangeTeamTextField}"/>
                </StackPanel>

                <!-- Search Area -->
                <StackPanel Grid.Row="1" Grid.Column="1" Margin="6,0,0,0">
                    <Label Style="{StaticResource OrangeTeamLabel}">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="MapMarker" Width="12" Height="12" 
                                           Foreground="{DynamicResource Primary}" Margin="0,0,6,0"/>
                            <TextBlock Text="Suchgebiet" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Label>
                    <TextBox Text="{Binding Suchgebiet, UpdateSourceTrigger=PropertyChanged}"
                            Style="{StaticResource OrangeTeamTextField}"
                            ToolTip="Suchgebiet (z.B. Sektor A)"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
