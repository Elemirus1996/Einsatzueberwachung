<Window x:Class="Einsatzueberwachung.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:fa="http://schemas.fontawesome.io/icons/"
        xmlns:vm="clr-namespace:Einsatzueberwachung.ViewModels"
        Title="{Binding WindowTitle}" 
        Height="900" Width="1600"
        MinHeight="600" MinWidth="1200"
        Icon="pack://application:,,,/Resources/app.ico"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize"
        WindowState="Normal"
        Background="{DynamicResource Surface}">

    <!-- DataContext wird über Code-Behind gesetzt -->
    <!-- <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext> -->

    <Window.InputBindings>
        <!-- Keyboard Shortcuts -->
        <KeyBinding Key="F11" Command="{Binding FullscreenToggleCommand}"/>
        <KeyBinding Modifiers="Ctrl" Key="N" Command="{Binding AddTeamCommand}"/>
        <KeyBinding Modifiers="Ctrl" Key="E" Command="{Binding ExportCommand}"/>
        <KeyBinding Modifiers="Ctrl" Key="T" Command="{Binding ThemeToggleCommand}"/>
        <KeyBinding Modifiers="Ctrl" Key="H" Command="{Binding HelpCommand}"/>
        
        <!-- F1-F10 Team Timer Shortcuts -->
        <KeyBinding Key="F1" Command="{Binding TeamTimerCommand}" CommandParameter="0"/>
        <KeyBinding Key="F2" Command="{Binding TeamTimerCommand}" CommandParameter="1"/>
        <KeyBinding Key="F3" Command="{Binding TeamTimerCommand}" CommandParameter="2"/>
        <KeyBinding Key="F4" Command="{Binding TeamTimerCommand}" CommandParameter="3"/>
        <KeyBinding Key="F5" Command="{Binding TeamTimerCommand}" CommandParameter="4"/>
        <KeyBinding Key="F6" Command="{Binding TeamTimerCommand}" CommandParameter="5"/>
        <KeyBinding Key="F7" Command="{Binding TeamTimerCommand}" CommandParameter="6"/>
        <KeyBinding Key="F8" Command="{Binding TeamTimerCommand}" CommandParameter="7"/>
        <KeyBinding Key="F9" Command="{Binding TeamTimerCommand}" CommandParameter="8"/>
        <KeyBinding Key="F10" Command="{Binding TeamTimerCommand}" CommandParameter="9"/>
    </Window.InputBindings>

    <Window.Resources>
        <!-- Custom Styles for MainWindow using global design system -->
        <Style x:Key="HeaderCard" TargetType="Border" BasedOn="{StaticResource Card}">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#FF7043" Offset="0"/>
                        <GradientStop Color="#F4511E" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Effect" Value="{StaticResource Elevation2}"/>
            <Setter Property="CornerRadius" Value="0,0,16,16"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Padding" Value="24,16"/>
        </Style>
        
        <Style x:Key="ClockDisplay" TargetType="TextBlock" BasedOn="{StaticResource DisplayMedium}">
            <Setter Property="Foreground" Value="{DynamicResource Primary}"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Effect" Value="{StaticResource Elevation1}"/>
        </Style>
        
        <Style x:Key="ActionButton" TargetType="Button" BasedOn="{StaticResource FilledButton}">
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="Padding" Value="20,12"/>
        </Style>
        
        <Style x:Key="IconButton" TargetType="Button" BasedOn="{StaticResource FAB}">
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Margin" Value="4,0"/>
        </Style>
        
        <Style x:Key="WelcomeHero" TargetType="Border" BasedOn="{StaticResource CardElevated}">
            <Setter Property="Background" Value="{DynamicResource PrimaryContainer}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Primary}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="5"/>   <!-- Trennlinie zwischen den Bereichen -->
            <ColumnDefinition Width="400"/> <!-- Rechte Spalte für Notizen & Funksprüche -->
        </Grid.ColumnDefinitions>

        <!-- Linke Hauptseite mit Teams -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 🏢 Professional Header -->
            <Border Grid.Row="0" Style="{StaticResource HeaderCard}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Mission Info Section -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Professional Logo -->
                        <Border Width="56" Height="56" CornerRadius="28" 
                               Background="White" Margin="0,0,20,0"
                               BorderBrush="White" BorderThickness="2">
                            <Border.Effect>
                                <DropShadowEffect Color="Black" Direction="270" ShadowDepth="2" 
                                                  Opacity="0.2" BlurRadius="6"/>
                            </Border.Effect>
                            <Image Source="/Resources/logo.jpeg" 
                                  Stretch="UniformToFill" Width="48" Height="48" ClipToBounds="True">
                                <Image.Clip>
                                    <EllipseGeometry RadiusX="24" RadiusY="24" Center="24,24"/>
                                </Image.Clip>
                            </Image>
                        </Border>
                        
                        <!-- Mission Details -->
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding EinsatzInfo}" Style="{StaticResource TitleLarge}"
                                      Foreground="White"/>
                            <TextBlock Text="{Binding Einsatzort}" Style="{StaticResource BodyMedium}"
                                      Foreground="White" Opacity="0.9"/>
                            <TextBlock Text="{Binding Einsatzleiter}" Style="{StaticResource BodyMedium}"
                                      Foreground="White" Opacity="0.9"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Central Clock & Status -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding CurrentTime}" 
                                  Style="{StaticResource DisplayMedium}"
                                  Foreground="White"
                                  FontFamily="Consolas"
                                  FontWeight="Bold"
                                  HorizontalAlignment="Center"/>
                        
                        <Border Background="White" CornerRadius="20" 
                               Padding="16,6" Margin="0,8,0,0">
                            <TextBlock Text="F1-F10: Teams | Strg+N: + Team | F11: Vollbild" 
                                      FontSize="13"
                                      FontWeight="SemiBold"
                                      Foreground="#F4511E"
                                      HorizontalAlignment="Center"/>
                        </Border>
                    </StackPanel>

                    <!-- Action Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Team Counter Badge -->
                        <Border Background="{DynamicResource PrimaryContainer}" CornerRadius="16" 
                               Padding="12,6" Margin="0,0,12,0">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Users" Width="14" Height="14" 
                                               Foreground="{DynamicResource OnPrimaryContainer}" Margin="0,0,6,0"/>
                                <TextBlock Text="{Binding TeamCount}" 
                                          Style="{StaticResource LabelMedium}"
                                          Foreground="{DynamicResource OnPrimaryContainer}"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Primary Actions -->
                        <Button Command="{Binding AddTeamCommand}" 
                               Style="{StaticResource ActionButton}"
                               Background="{DynamicResource Primary}"
                               ToolTip="Hundeteam hinzufügen (Strg+N)">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Plus" Width="14" Height="14" 
                                               Foreground="White" Margin="0,0,6,0"/>
                                <TextBlock Text="Team" Foreground="White"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Secondary Actions -->
                        <Button Command="{Binding HelpCommand}" 
                               Style="{StaticResource IconButton}"
                               Background="{DynamicResource Secondary}"
                               ToolTip="Hilfe und Tastenkürzel">
                            <fa:ImageAwesome Icon="QuestionCircle" Width="20" Height="20" Foreground="White"/>
                        </Button>
                        
                        <Button Command="{Binding ThemeToggleCommand}" 
                               Style="{StaticResource IconButton}"
                               Background="{DynamicResource Secondary}"
                               ToolTip="{Binding ThemeTooltip}">
                            <fa:ImageAwesome Icon="{Binding ThemeIcon}" Width="20" Height="20" Foreground="White"/>
                        </Button>
                        
                        <Button Command="{Binding ExportCommand}" 
                               Style="{StaticResource ActionButton}"
                               Background="{DynamicResource Success}">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Download" Width="14" Height="14" 
                                               Foreground="White" Margin="0,0,6,0"/>
                                <TextBlock Text="Export" Foreground="White"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Command="{Binding MenuCommand}" 
                               Style="{StaticResource IconButton}"
                               Background="{DynamicResource Outline}"
                               ToolTip="Menü">
                            <fa:ImageAwesome Icon="Bars" Width="18" Height="18" Foreground="White"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 🐕 Teams Container - DASHBOARD VIEW ONLY -->
            <Grid Grid.Row="1" Margin="8" Background="{DynamicResource SurfaceContainer}">
                
                <!-- DASHBOARD VIEW: Kompakte Übersicht -->
                <ScrollViewer x:Name="DashboardScrollViewer" 
                             VerticalScrollBarVisibility="Auto" 
                             HorizontalScrollBarVisibility="Disabled" 
                             Padding="4"
                             Background="Transparent"
                             Visibility="Visible">
                    <UniformGrid x:Name="DashboardGrid" Columns="5" VerticalAlignment="Top"/>
                </ScrollViewer>
                
                <!-- Enhanced Welcome Message -->
                <Border Visibility="{Binding WelcomeMessageVisibility}" 
                        Style="{StaticResource WelcomeHero}"
                        VerticalAlignment="Center" HorizontalAlignment="Center"
                        MaxWidth="800">
                    
                    <StackPanel TextBlock.TextAlignment="Center">
                        <!-- Hero Icon -->
                        <Viewbox Width="120" Height="120" Margin="0,0,0,24">
                            <Grid>
                                <Ellipse Fill="{DynamicResource Primary}" Width="120" Height="120"/>
                                <Image Source="/Resources/logo.jpeg" 
                                       Stretch="UniformToFill" Width="80" Height="80" 
                                       ClipToBounds="True" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Image.Clip>
                                        <EllipseGeometry RadiusX="40" RadiusY="40" Center="40,40"/>
                                    </Image.Clip>
                                </Image>
                            </Grid>
                        </Viewbox>
                        
                        <!-- Welcome Content -->
                        <TextBlock Text="Willkommen bei Professional v1.9.0!" 
                                  Style="{StaticResource HeadlineSmall}"
                                  Foreground="{DynamicResource Primary}" 
                                  Margin="0,0,0,16"/>
                        
                        <TextBlock Style="{StaticResource BodyLarge}"
                                  Foreground="{DynamicResource OnSurface}" 
                                  LineHeight="28" Margin="0,0,0,32">
                            <Run Text="Klicken Sie auf"/>
                            <Run Text="+ Team" FontWeight="Bold" Foreground="{DynamicResource Primary}"/>
                            <Run Text="um Ihr erstes Hundeteam hinzuzufügen."/>
                            <LineBreak/><LineBreak/>
                            <Run Text="💡 Klicken Sie auf eine Team-Karte für Details!" FontWeight="Medium"/>
                        </TextBlock>
                        
                        <!-- CTA Button -->
                        <Button Command="{Binding AddTeamCommand}" Style="{StaticResource FilledButton}" 
                               Background="{DynamicResource Success}"
                               Padding="32,16" FontSize="16">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="Plus" Width="18" Height="18" 
                                               Foreground="White" Margin="0,0,12,0"/>
                                <TextBlock Text="Erstes Team hinzufügen" Foreground="White" FontWeight="Medium"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- 📊 Professional Status Bar -->
            <Border Grid.Row="2" Background="{DynamicResource Surface}" 
                    BorderBrush="{DynamicResource OutlineVariant}" BorderThickness="0,1,0,0" 
                    Padding="16,8">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Direction="90" ShadowDepth="1" 
                                    Opacity="0.1" BlurRadius="4"/>
                </Border.Effect>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Status Information -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Background="{DynamicResource SuccessContainer}" CornerRadius="12" 
                               Padding="8,4" Margin="0,0,12,0">
                            <StackPanel Orientation="Horizontal">
                                <fa:ImageAwesome Icon="CheckCircle" Width="12" Height="12" 
                                               Foreground="{DynamicResource Success}" Margin="0,0,4,0"/>
                                <TextBlock Text="AKTIV" Style="{StaticResource LabelSmall}"
                                          Foreground="{DynamicResource OnSuccessContainer}"/>
                            </StackPanel>
                        </Border>

                        <TextBlock Text="{Binding StatusText}" 
                                  Style="{StaticResource BodyMedium}"
                                  Foreground="{DynamicResource OnSurface}" 
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- System Log -->
                    <TextBlock Text="{Binding LastLogText}" Grid.Column="1" 
                              Style="{StaticResource BodySmall}"
                              FontFamily="Consolas" 
                              Foreground="{DynamicResource OnSurfaceVariant}"
                              VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Trennlinie zwischen den Bereichen -->
        <Border Grid.Column="1" Background="{DynamicResource OutlineVariant}"/>

        <!-- Rechte Seite: Globale Notizen & Funksprüche -->
        <Grid Grid.Column="2" Background="{DynamicResource SurfaceVariant}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="*"/>     <!-- Notizen/Funksprüche Liste -->
                <RowDefinition Height="Auto"/>  <!-- Eingabefeld -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                    Padding="15"
                    CornerRadius="5,5,0,0">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#FF7043" Offset="0"/>
                        <GradientStop Color="#F4511E" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="📝 Notizen &amp; Funksprüche" 
                                   FontSize="18" 
                                   FontWeight="Bold" 
                                   Foreground="White"/>
                        <TextBlock Text="Einsatzübergreifende Dokumentation" 
                                   FontSize="12" 
                                   Foreground="White" 
                                   Opacity="0.9"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                    
                    <!-- Export Log Button -->
                    <Button Grid.Column="1" 
                            Command="{Binding ExportLogCommand}"
                            Background="{DynamicResource Success}"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="12,8"
                            Cursor="Hand"
                            ToolTip="Einsatz-Log exportieren (nur relevante Daten)">
                        <StackPanel Orientation="Horizontal">
                            <fa:ImageAwesome Icon="Download" Width="12" Height="12" Foreground="White" Margin="0,0,5,0"/>
                            <TextBlock Text="Log" FontWeight="SemiBold" Foreground="White"/>
                        </StackPanel>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    CornerRadius="5" 
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#2E7D32"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>

            <!-- Notizen & Funksprüche Liste -->
            <Border Grid.Row="1" 
                    Background="{DynamicResource Surface}" 
                    BorderBrush="{DynamicResource Outline}" 
                    BorderThickness="1,0,1,1">
                <ScrollViewer x:Name="GlobalNotesScrollViewer" 
                              VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="10">
                    <ItemsControl ItemsSource="{Binding FilteredNotesCollection}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SurfaceVariant}" 
                                        BorderBrush="{DynamicResource Outline}" 
                                        BorderThickness="1" 
                                        CornerRadius="5" 
                                        Padding="10" 
                                        Margin="0,0,0,8">
                                    <StackPanel>
                                        <!-- Zeitstempel & Team-Info -->
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <TextBlock Grid.Column="0" 
                                                       Text="{Binding FormattedTimestamp}" 
                                                       FontWeight="Bold" 
                                                       FontFamily="Consolas, Courier New"
                                                       Foreground="{DynamicResource Primary}"/>
                                            
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding TeamName}" 
                                                       FontSize="11" 
                                                       FontWeight="SemiBold"
                                                       Foreground="{DynamicResource OnSurfaceVariant}" 
                                                       Margin="10,0,0,0"
                                                       VerticalAlignment="Center"/>
                                            
                                            <TextBlock Grid.Column="2" 
                                                       Text="{Binding EntryTypeIcon}" 
                                                       FontSize="14" 
                                                       VerticalAlignment="Center"/>
                                        </Grid>

                                        <!-- Inhalt -->
                                        <TextBlock Text="{Binding Content}" 
                                                   TextWrapping="Wrap" 
                                                   Margin="0,5,0,0"
                                                   Foreground="{DynamicResource OnSurface}"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Eingabebereich -->
            <Border Grid.Row="2" 
                    Background="{DynamicResource Surface}" 
                    BorderBrush="{DynamicResource Outline}" 
                    BorderThickness="1,0,1,1"
                    CornerRadius="0,0,5,5"
                    Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Schnellnotiz Eingabe -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0"
                                 Padding="10" 
                                 FontSize="13"
                                 Style="{StaticResource TextField}"
                                 VerticalAlignment="Stretch"
                                 Text="{Binding QuickNoteText, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.InputBindings>
                                <KeyBinding Key="Enter" Command="{Binding AddQuickNoteCommand}"/>
                            </TextBox.InputBindings>
                        </TextBox>

                        <Button Grid.Column="1" 
                                Content="➕ Hinzufügen" 
                                Padding="15,10"
                                Margin="5,0,0,0"
                                Background="{DynamicResource Primary}"
                                Foreground="{DynamicResource OnPrimary}"
                                BorderThickness="0"
                                FontWeight="SemiBold"
                                Command="{Binding AddQuickNoteCommand}"
                                Cursor="Hand">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        CornerRadius="5" 
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource Tertiary}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>

                    <!-- Team-Auswahl für Notiz -->
                    <ComboBox Grid.Row="1"
                              Margin="0,5,0,0"
                              Padding="10,8"
                              SelectedIndex="0"
                              ItemsSource="{Binding NoteTargets}"
                              Style="{StaticResource ComboBoxStyle}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding DisplayName}" 
                                               FontWeight="SemiBold" 
                                               Margin="0,0,10,0"/>
                                    <TextBlock Text="{Binding DetailInfo}" 
                                               Foreground="{DynamicResource OnSurfaceVariant}" 
                                               FontSize="11"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
